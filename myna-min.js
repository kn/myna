(function(){var a,j,i;i=this;j=i.Myna;a={};a="undefined"!==typeof exports?exports:i.Myna={};a.VERSION="0.2.0";a.noConflict=function(){i.Myna=j;return this};a.compile=function(b,f){var c,e,d,h,i,g;g=b.text;h=b.user.name;d=b.entities.user_mentions;e=b.entities.hashtags;g=a._handle_special_cases(g);i=" "+a._get_start_context(d,g)+': "';g=a._slice_context(g);c=a._get_end_context(g);g=a._replace_ht_with_speakable(g);g=a._replace_rt_with_speakable(d,g);g=a._replace_mentions_with_speakable(d,g);g=a._replace_hashtags_with_speakable(e,
g);g=f&&f.withURL?a._replace_urls_with_speakable(b.entities.urls,g):a._remove_urls(b.entities.urls,g);return h+(""+i+g+c)};a._get_start_context=function(b,f){var c;if(f.match(/^OH[\s:]/))return"overheard";if(c=f.match(/^RT\s@(\w+):/))return c=a._get_name_by_screen_name(b,c[1]),"retweeted a tweet of "+c;if(f.match(/^RT[\s:]/))return"retweeted";return f.match(/^(@\w+\s)+/)?(c=a._get_in_reply_to_array(b),c=a._en_and_join(c),"tweeted in reply to "+c):"tweeted"};a._get_end_context=function(){return'"'};
a._slice_context=function(b){return b.replace(/^(OH[\s:]|RT\s@(\w+):|RT[\s:]|(@\w+\s)+)/,"").trim()};a._replace_rt_with_speakable=function(b,f){var c;if(c=f.match(/\sRT\s@(\w+):\s/))c=a._get_name_by_screen_name(b,c[1]),f=f.replace(/\sRT\s@\w+:\s/," in reply to a tweet of "+c+": ");return f.replace(/\sRT(\s|:\s)/," in reply to: ")};a._replace_ht_with_speakable=function(b){return b.replace(/HT:?/,"Heard through")};a._replace_hashtags_with_speakable=function(b,f){var c,e,d,h,b=f.match(/#\w+/g);if(null!=
b)for(d=0,h=b.length;d<h;d++)c=b[d],e=RegExp(c),f=f.replace(e,a._spacify(c.slice(1,c.length-1+1||9E9)));return f};a._replace_urls_with_speakable=function(b,f){var c,a,d,h;for(d=0,h=b.length;d<h;d++)a=b[d],c=a.display_url?a.display_url:a.expanded_url?a.expanded_url:a.url,c=c.replace(/^https?:\/\//,""),c=c.replace(/^([^\/]+)\/.*$/,"$1"),c=c.replace(/\./g," dot "),a=RegExp(""+a.display_url+"|"+a.url),f=f.replace(a,"(Link to "+c+")");return f};a._remove_urls=function(b,a){var c,e,d;for(e=0,d=b.length;e<
d;e++)c=b[e],c=RegExp("s?("+c.display_url+"|"+c.url+")s?"),a=a.replace(c," ");return a.trim()};a._replace_mentions_with_speakable=function(b,a){var c,e,d,h;for(d=0,h=b.length;d<h;d++)c=b[d],e=RegExp("@"+c.screen_name,"i"),a=a.replace(e,c.name);return a};a._handle_special_cases=function(b){b=b.replace(/^\./,"");b=b.replace(/\sw\/\s/," with ");return b=b.replace(/\s?:=?[)pD]\s?/g," ")};a._get_name_by_screen_name=function(b,a){var c,e,d;for(e=0,d=b.length;e<d;e++)if(c=b[e],c.screen_name===a)return c.name};
a._en_and_join=function(b){var a;if(1===b.length)return b[0];if(2===b.length)return""+b[0]+" and "+b[1];if(2<b.length)return a=b.slice(0,b.length-2+1||9E9).join(", "),""+a+" and "+b[b.length-1]};a._spacify=function(b){b=b.replace(/_/g," ");b=b.replace(/([A-Z][a-z]+)/g," $1 ");b=b.replace(/\s\s/g," ");return b.trim()};return a._get_in_reply_to_array=function(b){var a,c,e,d,h;a=[];if(b){c=0;for(d=0,h=b.length;d<h;d++)if(e=b[d],3>e.indices[0]-c)a.push(e.name),c=e.indices[1];else break}return a}}).call(this);
