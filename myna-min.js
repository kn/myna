(function(){var b,j,i;i=this;j=i.Myna;b={};b="undefined"!==typeof exports?exports:i.Myna={};b.noConflict=function(){i.Myna=j;return this};b.compile=function(a,g){var c,d,e,h,i,f;f=a.text;h=a.user.name;e=a.entities.user_mentions;c=a.entities.hashtags;d=a.entities.media;f=b._handle_special_cases(f);i=" "+b._get_start_context(e,d,f)+": ";f=b._slice_context(f);f=b._remove_media_links(d,f);f=b._replace_ht_with_speakable(f);f=b._replace_rt_with_speakable(e,f);f=b._replace_mentions_with_speakable(e,f);f=
b._replace_hashtags_with_speakable(c,f);f=g&&g.withURL?b._replace_urls_with_speakable(a.entities.urls,f):b._remove_urls(a.entities.urls,f);f=b._remove_distractive_symbols(f);f=b._replace_symbols(f);return h+(""+i+f)};b._get_start_context=function(a,g,c){var d;c.match(/^OH[\s:]/)?a="overheard":(d=c.match(/^RT\s@(\w+):/))?(a=b._get_name_by_screen_name(a,d[1]),a="retweeted a tweet of "+a):c.match(/^RT[\s:]/)?a="retweeted":c.match(/^(@\w+\s)+/)?(a=b._get_in_reply_to_array(a),a=b._en_and_join(a),a="tweeted in reply to "+
a):a="tweeted";g&&0<g.length&&(a+=" with "+g[0].type);return a};b._slice_context=function(a){return a.replace(/^(OH[\s:]|RT\s@(\w+):|RT[\s:]|(@\w+\s)+)/,"").trim()};b._replace_rt_with_speakable=function(a,g){var c;if(c=g.match(/\sRT\s@(\w+):\s/))c=b._get_name_by_screen_name(a,c[1]),g=g.replace(/\sRT\s@\w+:\s/," in reply to a tweet of "+c+": ");return g.replace(/\sRT(\s|:\s)/," in reply to: ")};b._replace_ht_with_speakable=function(a){return a.replace(/HT:?/,"Heard through")};b._replace_hashtags_with_speakable=
function(a,g){var c,d,e,h,a=g.match(/#\w+/g);if(null!=a)for(e=0,h=a.length;e<h;e++)c=a[e],d=RegExp(c),g=g.replace(d,b._spacify(c.slice(1,c.length-1+1||9E9)));return g};b._replace_urls_with_speakable=function(a,g){var c,d,b,h;for(b=0,h=a.length;b<h;b++)d=a[b],c=d.display_url?d.display_url:d.expanded_url?d.expanded_url:d.url,c=c.replace(/^https?:\/\//,""),c=c.replace(/^([^\/]+)\/.*$/,"$1"),c=c.replace(/\./g," dot "),d=RegExp(""+d.display_url+"|"+d.url),g=g.replace(d,"(Link to "+c+")");return g};b._remove_urls=
function(a,b){var c,d,e;for(d=0,e=a.length;d<e;d++)c=a[d],c=RegExp("s?("+c.display_url+"|"+c.url+")s?"),b=b.replace(c," ");return b.trim()};b._replace_mentions_with_speakable=function(a,b){var c,d,e,h;for(e=0,h=a.length;e<h;e++)c=a[e],d=RegExp("@"+c.screen_name,"i"),b=b.replace(d,c.name);return b};b._remove_media_links=function(a,b){var c,d,e;if(a)for(d=0,e=a.length;d<e;d++)c=a[d],c=RegExp("s?("+c.display_url+"|"+c.url+")s?"),b=b.replace(c," ");return b};b._handle_special_cases=function(a){return a=
a.replace(/^\./,"")};b._replace_symbols=function(a){a=a.replace(/\sw\/\s/," with ");a=a.replace(/\s?:=?[)pD]\s?/g," ");a=a.replace(/\s&\s/g," and ");a=a.replace(/\s<3\s/g," love ");return a=a.replace(/\s&lt;3\s/g,"love")};b._remove_distractive_symbols=function(a){a=a.replace(/\s#\s/g," ");return a=a.replace(/[_;\^]/g,"")};b._get_name_by_screen_name=function(a,b){var c,d,e;for(d=0,e=a.length;d<e;d++)if(c=a[d],c.screen_name===b)return c.name};b._en_and_join=function(a){var b;if(1===a.length)return a[0];
if(2===a.length)return""+a[0]+" and "+a[1];if(2<a.length)return b=a.slice(0,a.length-2+1||9E9).join(", "),""+b+" and "+a[a.length-1]};b._spacify=function(a){a=a.replace(/_/g," ");a=a.replace(/([A-Z][a-z]+)/g," $1 ");a=a.replace(/\s\s/g," ");return a.trim()};return b._get_in_reply_to_array=function(a){var b,c,d,e,h;b=[];if(a){c=0;for(e=0,h=a.length;e<h;e++)if(d=a[e],3>d.indices[0]-c)b.push(d.name),c=d.indices[1];else break}return b}}).call(this);
